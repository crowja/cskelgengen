SHELL = /bin/sh

.POSIX:
.SUFFIXES:
.SUFFIXES:

SRC_DIR      = ./src
BUILD_DIR    = ./build

CC           = gcc
CPPFLAGS     = -I$(SRC_DIR) @CPPFLAGS@ 
##GCC_SANITIZE_FLAGS = -fsanitize=address -fsanitize=undefined -fno-omit-frame-pointer
GCC_SANITIZE_FLAGS =
CFLAGS       = -std=c99 -pedantic -Wall
LDFLAGS      = @LDFLAGS@ $(GCC_SANITIZE_FLAGS)
LDLIBS       = @LIBS@

MKDIR_P      = /bin/mkdir -p
RM           = /bin/rm -f

.PHONY: all clean dirs

all: dirs $(BUILD_DIR)/a.out

dirs:
	@$(MKDIR_P) $(BUILD_DIR)

$(BUILD_DIR)/a.out: $(BUILD_DIR)/linewrapper.o
$(BUILD_DIR)/a.out: $(BUILD_DIR)/main.o
$(BUILD_DIR)/a.out: $(BUILD_DIR)/options.o
$(BUILD_DIR)/a.out: $(BUILD_DIR)/varstr.o
$(BUILD_DIR)/a.out: 
	$(CC) -o $(BUILD_DIR)/a.out \
		$(BUILD_DIR)/linewrapper.o \
		$(BUILD_DIR)/main.o \
		$(BUILD_DIR)/options.o \
		$(BUILD_DIR)/varstr.o \
		$(LDFLAGS) $(LDLIBS)

$(BUILD_DIR)/linewrapper.o: $(SRC_DIR)/linewrapper.c $(SRC_DIR)/linewrapper.h
	$(CC) -c $(CPPFLAGS) $(CFLAGS) -o $(BUILD_DIR)/linewrapper.o $(SRC_DIR)/linewrapper.c

$(BUILD_DIR)/main.o: $(SRC_DIR)/main.c $(SRC_DIR)/main.h 
	$(CC) -c $(CPPFLAGS) $(CFLAGS) -o $(BUILD_DIR)/main.o $(SRC_DIR)/main.c

$(BUILD_DIR)/options.o: $(SRC_DIR)/options.c $(SRC_DIR)/options.h
	$(CC) -c $(CPPFLAGS) $(CFLAGS) -o $(BUILD_DIR)/options.o $(SRC_DIR)/options.c

$(BUILD_DIR)/varstr.o: $(SRC_DIR)/varstr.c $(SRC_DIR)/varstr.h
	$(CC) -c $(CPPFLAGS) $(CFLAGS) -o $(BUILD_DIR)/varstr.o $(SRC_DIR)/varstr.c



# Example of how to template for variables set by configure
howdy:

clean:
	$(RM) $(BUILD_DIR)/a.out $(BUILD_DIR)/*.o
	( cd src && $(MAKE) clean )

# SQLITE3_CFLAGS    is @SQLITE3_CFLAGS@
# SQLITE3_LDFLAGS   is @SQLITE3_LDFLAGS@
# PACKAGE_NAME      is @PACKAGE_NAME@
# PACKAGE_TARNAME   is @PACKAGE_TARNAME@
# PACKAGE_VERSION   is @PACKAGE_VERSION@
# PACKAGE_STRING    is @PACKAGE_STRING@
# PACKAGE_BUGREPORT is @PACKAGE_BUGREPORT@
# PACKAGE_URL       is @PACKAGE_URL@
#
# builddir          is @builddir@
# abs_builddir      is @abs_builddir@
# top_builddir      is @top_builddir@
# abs_top_builddir  is @abs_top_builddir@
# 
# srcdir            is @srcdir@
# abs_srcdir        is @abs_srcdir@
# top_srcdir        is @top_srcdir@
# abs_top_srcdir    is @abs_top_srcdir@
#
# CFLAGS            is @CFLAGS@
# DEFS              is @DEFS@
# LDFLAGS           is @LDFLAGS@
# LIBS              is @LIBS@
#
# prefix            is @prefix@
# exec_prefix       is @exec_prefix@
#
#                      @OPENMP_CFLAGS@"

distclean:
	$(MAKE) clean
	$(RM) -r autom4te.cache  config.status config.log

